<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>OpenNI 1.5.7: NiConvertXToONI.cpp - sample program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenNILogo.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNI 1.5.7
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">OpenNI Overview</a></li><li class="navelem"><a class="el" href="smpls_n_guides.html">Samples and Guides</a></li><li class="navelem"><a class="el" href="smpls.html">Sample Programs for the OpenNI API</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">NiConvertXToONI.cpp - sample program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><pre class="fragment">&lt;b&gt;Source file:&lt;/b&gt; Click the following link to view the source code file:
    - NiConvertXToONI.cpp

The program opens any recording, takes every node in this recording, and records it to a new ONI recording. It receives both input file and output file from the command line.

The documentation describes the sample program's code from the top of the program file(s) to bottom.

Every OpenNI feature is described the first time it appears in this sample program. Further appearances of the same feature are not decribed again.
</pre><h1><a class="anchor" id="cnvx2o_mainprg"></a>
main() â€“ Main Program</h1>
<h2><a class="anchor" id="cnvx2o_mainprg_dcl_blk"></a>
Main Program Declaration Block</h2>
<pre class="fragment">        The following code block sets the limits for the main program loop later in the program. 

        Setting seekNodeType to xn::XN_NODE_TYPE_INVALID "XN_NODE_TYPE_INVALID" is an initialization for &lt;code&gt;seekNodeType&lt;/code&gt; gets from the users run arguments  an indication whether the user wants to play back all nodes or just one specified node. The XN_NODE_TYPE_INVALID value for &lt;code&gt;seekNodeType&lt;/code&gt; initialization makes the program play back all nodes. 
</pre> <div class="fragment"><div class="line">XnUInt32 nStartFrame = 1;</div>
<div class="line">XnUInt32 nEndFrame = XN_MAX_UINT32;</div>
<div class="line"><a class="code" href="_xn_types_8h.html#ab786f8128488cec584d72c2642655e39">XnProductionNodeType</a> seekNodeType = <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>;</div>
</div><!-- fragment --><h2><a class="anchor" id="cnvx2o_get_prod_node"></a>
Get a Production Node From a String</h2>
<p>If the node type parameter (the third command line parameter) is specified, we translate the node type from a string to an XnProductionNodeType value using <a class="el" href="group__utils.html#ga008e328025255d260f225953056459d9">xnProductionNodeTypeFromString()</a>. </p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (argc &gt;= 4)</div>
<div class="line">{</div>
<div class="line">    strNodeType = argv[3];</div>
<div class="line">    nRetVal = <a class="code" href="group__utils.html#ga008e328025255d260f225953056459d9">xnProductionNodeTypeFromString</a>(strNodeType, &amp;seekNodeType);</div>
<div class="line">    <span class="keywordflow">if</span> (nRetVal != <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        ...</div>
<div class="line">    }</div>
<div class="line">    ...</div>
<div class="line">}       </div>
</div><!-- fragment --><p>The following initializes the <a class="el" href="classxn_1_1_context.html">xn::Context</a> object. This is where the application builds an OpenNI production graph. The <em>production graph</em> is a network of <em>production nodes</em> and is the principal OpenNI object structure. </p>
<div class="fragment"><div class="line">Context context;</div>
<div class="line">nRetVal = context.<a class="code" href="classxn_1_1_context.html#adfc68c424c840a788d0903e20a95e541" title="Builds the context&#39;s general software environment.">Init</a>();</div>
</div><!-- fragment --><p>The following code uses the <a class="el" href="classxn_1_1_player.html">xn::Player</a> node to replay a recorded file of a session of OpenNI data generation exactly as it was recorded. <code>strInputFile</code> contains the input file name, as above.</p>
<p>The <a class="el" href="classxn_1_1_context.html#a3589979f63d5b9ddea49b71dcdf9fc5a">OpenFileRecording()</a> method replays a recorded file of a session of OpenNI data generation exactly as it was recorded. This includes recreating the whole <a class="el" href="prod_graph.html">production graph</a>, with all its nodes, that was built to run the original data generation session. </p>
<div class="fragment"><div class="line">Player player;</div>
<div class="line">nRetVal = context.OpenFileRecording(strInputFile, player);</div>
</div><!-- fragment --><p>In the following statement, the <a class="el" href="classxn_1_1_player.html#a9804065d8fafb2a69d2133ac207a09eb">SetPlaybackSpeed()</a> method sets the player's playback speed, as a ratio of the rate that the recording was made at. The value <a class="el" href="_xn_types_8h.html#a2daadd99b97dd4b64536b1fbd19fbd20">xn::XN_PLAYBACK_SPEED_FASTEST</a> (0.0) means that there will be no delay, and that frames will be returned immediately on demand. </p>
<div class="fragment"><div class="line">nRetVal = player.SetPlaybackSpeed(<a class="code" href="_xn_types_8h.html#a2daadd99b97dd4b64536b1fbd19fbd20">XN_PLAYBACK_SPEED_FASTEST</a>);</div>
</div><!-- fragment --><p>In the following statement, the <a class="el" href="classxn_1_1_player.html#ad334f5b33a039c12e489743b77ede8c7">EnumerateNodes()</a> method places in <code>nodes</code> the list of all nodes created by the earlier call to <a class="el" href="classxn_1_1_context.html#a3589979f63d5b9ddea49b71dcdf9fc5a">OpenFileRecording()</a>. </p>
<div class="fragment"><div class="line">NodeInfoList nodes;</div>
<div class="line">nRetVal = player.EnumerateNodes(nodes);</div>
</div><!-- fragment --><p>In the following, the call to <a class="el" href="classxn_1_1_recorder.html#a4d544321e6bcad40d68db50353a0d6ee">Create()</a> initializes a Recorder object. This object records to a specified destination medium the frames of data from each node that was added to the Recorder node. </p>
<div class="fragment"><div class="line">Recorder recorder;</div>
<div class="line">nRetVal = recorder.Create(context);</div>
</div><!-- fragment --><p>In the following statement, the call to <a class="el" href="classxn_1_1_recorder.html#a1e84f796966c9808b2a26db0d5dfe621">SetDestination()</a> specifies to where the recorder must send its recording. This is a disk file of ONI type. </p>
<div class="fragment"><div class="line">nRetVal = recorder.SetDestination(<a class="code" href="group__recorder.html#gga3a9ee4c35a7384ba06a4d22f976f8e8aab2fd201e9160a675b83ca2a3e4d36a0c">XN_RECORD_MEDIUM_FILE</a>, strOutputFile);</div>
</div><!-- fragment --><h2><a class="anchor" id="cnvx2o_for_add_all_nodes_to_the_recorder"></a>
for() - Add all Nodes to the Recorder</h2>
<pre class="fragment">        The following 'for' loop adds to the recorder all the nodes in the @ref xn::NodeInfoList "NodeInfoList" that were obtained from the earlier call to the @ref xn::Player::EnumerateNodes() "EnumerateNodes()" method. A NodeInfoList object contains a list of @ref xn::NodeInfo "NodeInfo" objects. The NodeInfo class contains information about a @ref node_alternative "node", whether it is an existing node, or not-yet instantiated. In this case it is instantiated.
</pre> <div class="fragment"><div class="line"><span class="keywordflow">for</span> (NodeInfoList::Iterator it = nodes.Begin(); it != nodes.End(); ++it)</div>
<div class="line">{</div>
<div class="line"> ...</div>
<div class="line">}</div>
</div><!-- fragment --> <pre class="fragment">The body of the above for-loop is described in the following paragraphs.

NodeInfo nodeInfo = *it;

Ignore AudioGenerator nodes.
</pre> <div class="fragment"><div class="line"><span class="keywordflow">if</span> (nodeInfo.GetDescription().Type == <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52a8303fcf880f5c311b1a370c83cae3da3">XN_NODE_TYPE_AUDIO</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">continue</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The following statements use the <a class="el" href="classxn_1_1_node_info.html">xn::NodeInfo</a> object to get a reference to the actual <a class="el" href="classxn_1_1_production_node.html">ProductionNode</a> object. The ProductionNode class is a base class for all production nodes, including all <a class="el" href="classxn_1_1_generator.html">Generator</a> nodes. Thus, the OpenNI Production Graph is comprised entirely of production nodes of one type or another. </p>
<div class="fragment"><div class="line">ProductionNode node;</div>
<div class="line">nRetVal = nodeInfo.GetInstance(node);</div>
</div><!-- fragment --><p>The following '<code>if</code>' determines whether the user wants to play back all nodes or just one specific node. The XN_NODE_TYPE_INVALID value for <code>seekNodeType</code> indicates that the user wants to play back all nodes. This value was set in earlier code above. </p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (seekNodeType == <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>)</div>
</div><!-- fragment --><p>If the user wants all nodes to be played back and recorded then each and every node iterated by <code>nodeInfo</code> is added to the recorder. <a class="el" href="classxn_1_1_recorder.html#aa6023d6f933e831504c6ddaa8357927f">AddNodeToRecording()</a> adds a node to the recording, and starts recording data that the node generates. </p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (seekNodeType == <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>)</div>
<div class="line">{</div>
<div class="line">    nRetVal = recorder.AddNodeToRecording(node);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the user specifies a certain node type, the program selects and records only nodes of that type, <code>seekNodeType</code>, in the run parameter (explained earlier).</p>
<p>The <a class="el" href="classxn_1_1_player.html#adaea321d4b2fd64838e77b72ffb32a0f">SeekToFrame()</a> moves the player to a specific frame of a specific node, e.g., a DepthGenerator node, so it sets up the player so that it will play that node and from that frame onwards. <code>XN_PLAYER_SEEK_SET</code> specifies that the player must start from the frame number, <code>nStartFrame</code>. </p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (seekNodeType == nodeInfo.GetDescription().Type)</div>
<div class="line">{</div>
<div class="line">    nRetVal = player.SeekToFrame(node.GetName(), nStartFrame, <a class="code" href="_xn_types_8h.html#a580ba965e8eac7ba5f5733e5e2f1ab51aeb039adafb1c0b9c960cb7c75aadbc55">XN_PLAYER_SEEK_SET</a>);</div>
<div class="line">    nRetVal = recorder.AddNodeToRecording(node);</div>
<div class="line">}               </div>
</div><!-- fragment --><p>In the following, <a class="el" href="classxn_1_1_player.html#a10edc03c5054d09e2134299b13abeb40">SetRepeat()</a> specifies that the player will not automatically rewind to the beginning of the recording after reaching the end of the recording (the default behavior is to rewind). </p>
<div class="fragment"><div class="line">nRetVal = player.SetRepeat(<a class="code" href="_xn_platform_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div>
</div><!-- fragment --><h2><a class="anchor" id="cnvx2o_main_prog_loop"></a>
- Main Program Loop</h2>
<pre class="fragment">        Following is the main program loop. It waits for available data from any generator node and records it. The call to the @ref xn::Context::WaitAnyUpdateAll()  "context.WaitAnyUpdateAll()" method updates all generator nodes in the context to the latest available data, first waiting for any of the nodes to have new data available. Since this method is being fed from a recording, the end of the recording is indicated by returning the XN_STATUS_EOF value. 

        Note that the @ref xn::Context::WaitAnyUpdateAll() "WaitAnyUpdateAll()" method has to be called for each and every loop to refresh the node's data.          
</pre> <div class="fragment"><div class="line"><span class="keywordflow">while</span> ((nRetVal = depth.WaitAnyUpdateAll ()) != XN_STATUS_EOF)</div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>Inside the body of the main program loop <code>nFrame</code> is incremented. An 'if' statement tests whether the user has specified a single node type and if so, and if the requested number of frames has been played back, then the execution of the main program loop is terminated. </p>
<div class="fragment"><div class="line">printf(<span class="stringliteral">&quot;Recording: %u\r&quot;</span>, nFrame++);</div>
<div class="line"><span class="keywordflow">if</span> ((seekNodeType != <a class="code" href="_xn_types_8h.html#ac773bbb9817dac5ae1be0f380ec18b52aecbdd244701d5cf6f3333faae8d235dd">XN_NODE_TYPE_INVALID</a>) &amp;&amp; (nFrame == nEndFrame))</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">break</span>;          </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 13:40:21 for OpenNI 1.5.7 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
