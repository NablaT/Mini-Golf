<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>OpenNI 1.5.7: NiSimpleRead.cpp - sample program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenNILogo.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNI 1.5.7
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">OpenNI Overview</a></li><li class="navelem"><a class="el" href="smpls_n_guides.html">Samples and Guides</a></li><li class="navelem"><a class="el" href="smpls.html">Sample Programs for the OpenNI API</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">NiSimpleRead.cpp - sample program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><pre class="fragment">&lt;b&gt;Source file:&lt;/b&gt; Click the following link to view the source code file:
    - NiSimpleRead.cpp

This section describes the SimpleRead sample program.
</pre><h1><a class="anchor" id="sr_glb_dcl_blk"></a>
Global Declaration Block</h1>
<p>The declaration block at the top of the program declares a Context object, a ScriptNode object, and an EnumerationErrors object. The context is workspace where the application builds an OpenNI production graph. The script node object loads and contains the OpenNI script and is the base node for the production graph. The <em>production graph</em> is a network of <em>production nodes</em> and is the principal OpenNI object model. The EnumerationErrors and XnStatus object types are for collecting errors from any of the OpenNI functions. Also declared is an OpenNI status flag for collecting return values from method calls. </p>
<div class="fragment"><div class="line"><a class="code" href="_xn_status_8h.html#a23967099202ddb640cd2044b3808253c">XnStatus</a> nRetVal = <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>;</div>
<div class="line">Context context;</div>
<div class="line">ScriptNode scriptNode;</div>
<div class="line">EnumerationErrors errors;</div>
</div><!-- fragment --><h1><a class="anchor" id="sr_func_main"></a>
Main Program</h1>
<h2><a class="anchor" id="sr_scrpt_sets_up_pg"></a>
Use Script to Set up a Context and Production Graph</h2>
<pre class="fragment">        The @ref xn::Context::InitFromXmlFile() "InitFromXmlFile()" method is a shorthand combination of two other initialization methods &amp;mdash; @ref xn::Context::Init() "Init()" and then @ref xn::Context::RunXmlScriptFromFile() "RunXmlScriptFromFile()" &amp;mdash; which initializes the context object and then creates a production graph from an XML file. The XML script file describes all the nodes you want to create. For each node description in the XML file, this method creates a node in the production graph.        
</pre> <div class="fragment"><div class="line">nRetVal = context.InitFromXmlFile(fn, scriptNode, &amp;errors);</div>
</div><!-- fragment --><h2><a class="anchor" id="sr_ver_nodes_in_script"></a>
Verify Existence of Nodes in the Sample Script File</h2>
<pre class="fragment">        Summary: This code is some more verification code. This time it checks that OpenNI found at least one node definition in the script file. The program continues execution only if at least one node definition if found. 
</pre> <div class="fragment"><div class="line"><span class="keywordflow">if</span> (nRetVal == XN_STATUS_NO_NODE_PRESENT)</div>
<div class="line">    {</div>
<div class="line">        XnChar strError[1024];</div>
<div class="line">        ...</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nRetVal != <a class="code" href="_xn_status_8h.html#a92729089d8e28e740a3f8b5169c8f695">XN_STATUS_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Open failed: %s\n&quot;</span>, <a class="code" href="_xn_status_8h.html#a709a2190465f4a6d7893587e53d66798">xnGetStatusString</a>(nRetVal));</div>
<div class="line">        <span class="keywordflow">return</span> (nRetVal);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="sr_get_node_from_pg"></a>
Get a Node from the Production Graph</h2>
<pre class="fragment">        Assuming that the above call to @ref xn::Context::InitFromXmlFile() "InitFromXmlFile()" succeeded, a production graph is then created. 

        The @ref xn::Context::FindExistingNode() "FindExistingNode()" method in the following code block tries to get a reference to any one of the production nodes. This call specifies XN_NODE_TYPE_DEPTH to get a reference to a @ref xn::DepthGenerator "DepthGenerator" node. A DepthGenerator node generates a depth map as an array of pixels, where each pixel is a depth value representing a distance from the sensor in millimeters. A reference to the node is returned in the depth parameter.   
</pre> <div class="fragment"><div class="line">DepthGenerator depth = (DepthGenerator)context.findExistingNode(NodeType.DEPTH);</div>
</div><!-- fragment --><h2><a class="anchor" id="sr_init_fps_calc"></a>
Initialize the FPS Calculator</h2>
<pre class="fragment">        The following declaration block initializes the FPS Calculator.
</pre> <div class="fragment"><div class="line"><a class="code" href="_xn_f_p_s_calculator_8h.html#ae5870d3d50dec1e2c2af17f976ba3f8f">XnFPSData</a> xnFPS;</div>
<div class="line">nRetVal = <a class="code" href="_xn_f_p_s_calculator_8h.html#a666d04413f1febe01823fcb320fcbb9b">xnFPSInit</a>(&amp;xnFPS, 180);</div>
</div><!-- fragment --><h2><a class="anchor" id="sr_decl_dg_fo"></a>
Declare the DepthGenerator's Frame Object</h2>
<pre class="fragment">        The following statement declares a metadata object to provide a @ref glos_frame_object "frame object" for the @ref xn::DepthGenerator node. A @ref dict_gen_node "generator node's" @ref glos_frame_object "frame object" contains a generated data frame and all its associated properties. This frame object, comprising the data frame and its properties, is accessible through the node's metadata object.
</pre> <div class="fragment"><div class="line">DepthMetaData depthMD;</div>
</div><!-- fragment --><h2><a class="anchor" id="sr_main_prg_loop"></a>
Main Program Loop</h2>
<pre class="fragment">        The main program loop repeatedly updates the data available in the node for output, and then gets the frame object (via the metadata object). The program then calculates the mid-point of the scene's 2D (two-dimensional) area.
</pre><h3><a class="anchor" id="sr_main_upd_data"></a>
Updating the Data Available for Output</h3>
<pre class="fragment">            the @ref xn::Context::WaitOneUpdateAll() "WaitOneUpdateAll()" method in the following statement updates all generator nodes in the context that have new data available, first waiting for a specified node to have new data available. The application can then get the data (for example, using a metadata GetData() method). This method has a timeout.      
</pre> <div class="fragment"><div class="line">nRetVal = context.WaitOneUpdateAll(depth);</div>
</div><!-- fragment --><h3><a class="anchor" id="sr_main_mark_the_frame"></a>
Mark the Frame</h3>
<div class="fragment"><div class="line"><a class="code" href="_xn_f_p_s_calculator_8h.html#a608895501083570d61c91395db6b24db">xnFPSMarkFrame</a>(&amp;xnFPS);</div>
</div><!-- fragment --><h3><a class="anchor" id="sr_main_get_data"></a>
Get the DepthGenerator's Data</h3>
<pre class="fragment">            The following statement gets the latest generated depth @ref glos_frame_object "frame object", saving it as a metadata object. 
</pre> <div class="fragment"><div class="line">depth.GetMetaData(depthMD);</div>
</div><!-- fragment --><p>The following print statement accesses the frame data, its ID, and the frame data's associated configuration, The frame ID is the ID of the frame object. Frame IDs are a sequential unique number with a wrap around. This method is inherited from the OutputMetaData class. </p>
<div class="fragment"><div class="line">printf(<span class="stringliteral">&quot;Frame %d Middle point is: %u. FPS: %f\n&quot;</span>, depthMD.FrameID(), depthMD(depthMD.XRes() / 2, depthMD.YRes() / 2), <a class="code" href="_xn_f_p_s_calculator_8h.html#ad86193813c6c0fa46610cf3bea64c550">xnFPSCalc</a>(&amp;xnFPS));</div>
</div><!-- fragment --><p>In the above, <a class="el" href="classxn_1_1_map_meta_data.html#a88773e165cbc69e091e87781ca43bdb7">XRes()</a> and <a class="el" href="classxn_1_1_map_meta_data.html#a59e8d198dada0c527436196592dc320c">YRes()</a> are the dimensions of the FOV in the scene. The call to <b>depthMD()</b> accesses a depth pixel through an X,Y coordinate. By calculating <b>XRes()/2</b> and <b>YRes()/2</b>, this accesses the middle pixel. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 13:40:21 for OpenNI 1.5.7 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
