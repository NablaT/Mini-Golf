<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>OpenNI 1.5.7: SimpleViewer.java - sample program (Java)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenNILogo.bmp"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNI 1.5.7
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">OpenNI Overview</a></li><li class="navelem"><a class="el" href="smpls_n_guides.html">Samples and Guides</a></li><li class="navelem"><a class="el" href="smpls.html">Sample Programs for the OpenNI API</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SimpleViewer.java - sample program (Java) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><pre class="fragment">&lt;b&gt;Source file:&lt;/b&gt; Click the following link to view the source code file:
    - SimpleViewer.java

This section describes the SimpleViewer sample program in the Java language. This sample program uses a DepthGenerator node to build an accumulative histogram from depth values.

The documentation describes the sample program's code from the top of the program file(s) to bottom.

Every OpenNI feature is described the first time it appears in this sample program. Further appearances of the same feature are not decribed again.
</pre><h1><a class="anchor" id="svj_glb_dcl_blk"></a>
Global Declaration Block</h1>
<pre class="fragment">    The following declaration block declares the OpenNI objects required for building the OpenNI production graph. 
</pre> <div class="fragment"><div class="line"><span class="keyword">private</span> OutArg&lt;ScriptNode&gt; scriptNode;</div>
<div class="line"><span class="keyword">private</span> Context context;</div>
<div class="line"><span class="keyword">private</span> DepthGenerator depthGen;</div>
<div class="line"><span class="keyword">private</span> byte[] imgbytes;</div>
</div><!-- fragment --><p>Each of these declarations is described separately in the following paragraphs.</p>
<p>The <a class="el" href="classxn_1_1_script_node.html">ScriptNode</a> object loads an XML script from a file or string, and then runs the XML script to build a production graph . . The ScriptNode object keeps references to all nodes created from the script, so they will not be destroyed. (This is since OpenNI will delete a node that has no remaining references to it.)</p>
<p>A <a class="el" href="classxn_1_1_context.html">Context</a> object is a workspace in which the application builds an OpenNI production graph.</p>
<p>The <a class="el" href="classxn_1_1_depth_generator.html">DepthGenerator</a> node generates a depth map. Each map pixel value represents a distance from the sensor.</p>
<p>The <a class="el" href="classxn_1_1_depth_meta_data.html">DepthMetaData</a> object provides a <a class="el" href="glossary.html#glos_frame_object">frame object</a> for the <a class="el" href="classxn_1_1_depth_generator.html">DepthGenerator</a> node. A <a class="el" href="glossary.html#dict_gen_node">generator node's</a> frame object contains the generated data frame and all its associated properties. This frame object, comprising the data frame and its properties, is accessible through the node's metadata object.</p>
<p>The following definition is for the path to an OpenNI XML script file for inputting and building a stored production graph. The <em>production graph</em> is a network of <em>production nodes</em> and is the principal OpenNI object model. The identifies blobs as hands or human users. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SAMPLE_XML_PATH &quot;../../../../Data/SamplesConfig.xml&quot;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="svj_func_main"></a>
Main Program</h1>
<h2><a class="anchor" id="svj_scrpt_sets_up_pg"></a>
Uses a Script to Set up a Context and Production Graph</h2>
<pre class="fragment">        The following code block uses a script to set up a context and a production graph. The &lt;b&gt;Context.createFromXmlFile()&lt;/b&gt; method is a shorthand combination of two other initialization methods, which initializes the context object and then creates a production graph from an XML file. The XML script file describes all the nodes you want to create. For each node description in the XML file, this method creates a node in the production graph.      
</pre> <div class="fragment"><div class="line">scriptNode = <span class="keyword">new</span> OutArg&lt;ScriptNode&gt;();</div>
<div class="line">context = Context.createFromXmlFile(SAMPLE_XML_FILE, scriptNode);               </div>
</div><!-- fragment --><h2><a class="anchor" id="svj_get_dg_node_from_pg"></a>
Get a DepthGenerator Node from the Production Graph</h2>
<pre class="fragment">        The following statement creates and returns a reference to a @ref xn::DepthGenerator "DepthGenerator" node. The create() method can return a reference to an existing DepthGenerator node if one already exists in the production graph created from the XML. If no DepthGenerator node already exists, this method creates a new DepthGenerator node and returns a reference to the new node.      
</pre> <div class="fragment"><div class="line">depthGen = DepthGenerator.create(context);</div>
</div><!-- fragment --><p>The following statement gets the latest generated depth <a class="el" href="glossary.html#glos_frame_object">frame object</a>, saving it as a metadata object. </p>
<div class="fragment"><div class="line">DepthMetaData depthMD = depthGen.getMetaData();</div>
</div><!-- fragment --><p>The following sets up the array for the histogram array that is a key part of this sample program. (This is not OpenNI specific.) </p>
<div class="fragment"><div class="line">histogram = <span class="keyword">new</span> <span class="keywordtype">float</span>[10000];</div>
</div><!-- fragment --><p>The following code accesses some attributes of the frame data's associated configuration properties: getFullXRes() and getFullYRes() are the full frame resolution, i.e., the entire field-of-view, ignoring cropping of the FOV in the scene. </p>
<div class="fragment"><div class="line">width = depthMD.getFullXRes();</div>
<div class="line">height = depthMD.getFullYRes();</div>
</div><!-- fragment --><p>The remaining statements in this method are not OpenNI specific. </p>
<div class="fragment"><div class="line">imgbytes = <span class="keyword">new</span> byte[width*height];</div>
<div class="line"></div>
<div class="line">DataBufferByte dataBuffer = <span class="keyword">new</span> DataBufferByte(imgbytes, width*height);</div>
<div class="line">Raster raster = Raster.createPackedRaster(dataBuffer, width, height, 8, null);</div>
<div class="line">bimg = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_BYTE_GRAY);</div>
<div class="line">bimg.setData(raster);</div>
</div><!-- fragment --><h1><a class="anchor" id="svj_calcHist"></a>
CalcHist() - Using the Depth Values to Build an Accumulative Histogram</h1>
<pre class="fragment">    The following code block uses the depth values to build an accumulative histogram of frequency of occurrence of each depth value. The &lt;code&gt;depthMD.DepthMapPtrgetData().createShortBuffer()&lt;/code&gt;method returns a buffer that can be easily processed. The depth value is then used as an index into the histogram[] array.
</pre> <div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> calcHist(DepthMetaData depthMD)</div>
<div class="line">{</div>
<div class="line">    ...         </div>
<div class="line">    ShortBuffer depth = depthMD.getData().createShortBuffer();</div>
<div class="line">    depth.rewind();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">int</span> points = 0;</div>
<div class="line">    <span class="keywordflow">while</span>(depth.remaining() &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">short</span> depthVal = depth.get();</div>
<div class="line">        <span class="keywordflow">if</span> (depthVal != 0)</div>
<div class="line">        {</div>
<div class="line">            histogram[depthVal]++;</div>
<div class="line">            points++;</div>
<div class="line">        }</div>
<div class="line">    }   </div>
<div class="line">    ...</div>
<div class="line">    ...</div>
<div class="line">} </div>
</div><!-- fragment --><h1><a class="anchor" id="svj_update_depth_fn"></a>
updateDepth() method - Updating the Depth Map</h1>
<pre class="fragment">    The following statement sets up the frame object. It is described in the &lt;a href="#getMetaData"&gt;HandTracker() method above&lt;/a&gt;.  For more explanation on this, see @ref conc_meta_data, @ref glos_frame_object, and @ref frame_data.
</pre> <div class="fragment"><div class="line">DepthMetaData depthMD = depthGen.getMetaData();</div>
</div><!-- fragment --><p>The following method call waits for any node to have generated new data. This method then 'updates' each and every node in the entire production graph. For an overview to reading data and the <b>WaitXUpdateAll</b> methods, see <em><a class="el" href="conc_updating_data.html#conc_updating_data__summary_of_wait_fns">'Wait and Update' Methods</a></em>.</p>
<p>the <a class="el" href="classxn_1_1_context.html#a17fab043d7b6d60728511527a1d5c090">waitAnyUpdateAll()</a> method in the following statement updates all generator nodes in the context that have new data available, first waiting for any of the nodes to have new data available. The application can then get the data (for example, using a metadata GetData() method). This method has a timeout. </p>
<div class="fragment"><div class="line">context.waitAnyUpdateAll();</div>
</div><!-- fragment --><p>The following code block creates a convenient buffer for the depth map and then calls the calcHist() method to calculate the histogram. </p>
<div class="fragment"><div class="line">calcHist(depthMD);</div>
<div class="line">ShortBuffer depth = depthMD.getData().createShortBuffer();              </div>
<div class="line">depth.rewind();     </div>
</div><!-- fragment --><p>The following code block builds an image buffer according to the frequency of each depth value in the histogram. </p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span>(depth.remaining() &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> pos = depth.position();</div>
<div class="line">        <span class="keywordtype">short</span> pixel = depth.get();</div>
<div class="line">        imgbytes[pos] = (byte)histogram[pixel];</div>
<div class="line">    }       </div>
</div><!-- fragment --><h1><a class="anchor" id="svj_Dimension"></a>
Dimension() method</h1>
<pre class="fragment">    There are no OpenNI-specific declarations in this routine.
</pre><h1><a class="anchor" id="svj_paint"></a>
paint() method</h1>
<pre class="fragment">    There are no OpenNI-specific declarations in this routine.</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 13:40:21 for OpenNI 1.5.7 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
